{% load static %}
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AnnSci - Ù…Ø¹Ù„Ù… Ø§Ù„Ø¹Ù„ÙˆÙ… Ø§Ù„Ø°ÙƒÙŠ</title>
    <link rel="stylesheet" href="{% static 'chatbot/css/style.css' %}">
    <style>
        .input-buttons .action-btn {
            background: #6ec1e4;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            color: white;
            font-size: 1.2rem;
            border: none;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: background 0.3s ease;
        }
        .input-buttons .action-btn:hover {
            background: #4a9bd6;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <h1>ğŸ§ª AnnanScience</h1>
                <p class="subtitle">Ù…Ø¹Ù„Ù… Ø§Ù„Ø¹Ù„ÙˆÙ… Ø§Ù„ÙˆØ¯ÙˆØ¯ Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ!</p>
            </div>
            <div class="header-buttons">
                <button class="settings-btn">âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
            </div>
        </header>

        <!-- Settings Panel -->
        <div id="settings-panel" class="settings-panel hidden">
            <div class="settings-content">
                <h3>ğŸ”§ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h3>
                <div class="setting-group">
                    <label for="api-endpoint">Ù†Ù‚Ø·Ø© Ù†Ù‡Ø§ÙŠØ© API:</label>
                    <input type="text" id="api-endpoint" placeholder="https://your-api-endpoint.com/chat" value="YOUR_API_ENDPOINT_HERE">
                </div>
                <div class="setting-group">
                    <label for="api-key">Ù…ÙØªØ§Ø­ API:</label>
                    <input type="password" id="api-key" placeholder="Ø£Ø¯Ø®Ù„ Ù…ÙØªØ§Ø­ API Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ" value="YOUR_API_KEY_HERE">
                </div>
                <div class="setting-group">
                    <label for="system-prompt">Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù…:</label>
                    <textarea id="system-prompt" rows="4" placeholder="ÙƒÙŠÙ ÙŠØ¬Ø¨ Ø£Ù† Ø£ØªØµØ±ÙØŸ">Ø£Ù†Øª AnnanScienceØŒ Ù…Ø¹Ù„Ù… Ø¹Ù„Ù… ÙˆØ¯ÙˆØ¯ ÙˆÙ…ØªØ­Ù…Ø³ Ù„Ù„Ø£Ø·ÙØ§Ù„ Ù…Ù† Ø³Ù† 6 Ø¥Ù„Ù‰ 12 Ø¹Ø§Ù…Ù‹Ø§. Ø§Ø´Ø±Ø­ Ø¯Ø§Ø¦Ù…Ù‹Ø§ Ù…ÙØ§Ù‡ÙŠÙ… Ø§Ù„Ø¹Ù„Ù… Ø¨Ø·Ø±Ù‚ Ø¨Ø³ÙŠØ·Ø© ÙˆÙ…Ù…ØªØ¹Ø© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ØªØ´Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„ØªÙŠ ÙŠÙ…ÙƒÙ† Ù„Ù„Ø£Ø·ÙØ§Ù„ ÙÙ‡Ù…Ù‡Ø§. Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø±Ù…ÙˆØ² Ø§Ù„ØªØ¹Ø¨ÙŠØ±ÙŠØ© ÙˆØ´Ø¬Ø¹ Ø§Ù„ÙØ¶ÙˆÙ„. Ø§Ø¬Ø¹Ù„ Ø§Ù„Ø±Ø¯ÙˆØ¯ Ù…Ù†Ø§Ø³Ø¨Ø© Ù„Ù„Ø¹Ù…Ø± ÙˆÙ…Ø«ÙŠØ±Ø©!</textarea>
                </div>
                <button class="save-btn">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
                <button class="close-btn">âŒ Ø¥ØºÙ„Ø§Ù‚</button>
            </div>
        </div>

        <!-- Chat Container -->
        <main class="chat-container">
            <div id="chat-messages" class="chat-messages">
                {% for message in messages %}
                    {% if message.role == 'assistant' %}
                        <div class="message assistant-message">
                            <div class="message-avatar">ğŸ§ª</div>
                            <div class="message-content">{{ message.content|safe }}</div>
                        </div>
                    {% else %}
                        <div class="message user-message">
                            <div class="message-content">{{ message.content|safe }}</div>
                        </div>
                    {% endif %}
                {% empty %}
                    <div class="message assistant-message">
                        <div class="message-avatar">ğŸ§ª</div>
                        <div class="message-content">
                            <p>Ù…Ø±Ø­Ø¨Ù‹Ø§ ÙŠØ§ Ø¹Ø§Ù„Ù… ØµØºÙŠØ±! ğŸ‘‹ Ø£Ù†Ø§ AnnanScienceØŒ Ù…Ø¹Ù„Ù…Ùƒ Ø§Ù„Ø¹Ù„Ù…ÙŠ Ø§Ù„ÙˆØ¯ÙˆØ¯!</p>
                            <p>Ø§Ø³Ø£Ù„Ù†ÙŠ Ø£ÙŠ Ø´ÙŠØ¡ Ø¹Ù† Ø§Ù„Ø¹Ù„Ù… - Ù…Ù† Ù„Ù…Ø§Ø°Ø§ Ø§Ù„Ø³Ù…Ø§Ø¡ Ø²Ø±Ù‚Ø§Ø¡ ğŸŒŒ Ø¥Ù„Ù‰ ÙƒÙŠÙ ØªÙ†Ù…Ùˆ Ø§Ù„Ù†Ø¨Ø§ØªØ§Øª ğŸŒ±!</p>
                            <p>Ù…Ø§ Ø§Ù„Ø°ÙŠ ØªØ±ÙŠØ¯ Ø§Ø³ØªÙƒØ´Ø§ÙÙ‡ Ø§Ù„ÙŠÙˆÙ…ØŸ ğŸ”</p>
                        </div>
                    </div>
                {% endfor %}
            </div>
            
            <!-- Loading indicator -->
            <div id="loading" class="loading {% if not loading %}hidden{% endif %}">
                <div class="message assistant-message">
                    <div class="message-avatar">ğŸ§ª</div>
                    <div class="message-content">
                        <div class="typing-indicator">
                            <span></span>
                            <span></span>
                            <span></span>
                        </div>
                        <p>Ø£ÙÙƒØ± ÙÙŠ Ø³Ø¤Ø§Ù„Ùƒ... ğŸ¤”</p>
                    </div>
                </div>
            </div>
        </main>

        <!-- Input Area -->
        <div class="input-area">
            <form id="message-form" method="POST" action="{% url 'chatbot_view' %}" style="display: contents;">
                {% csrf_token %}
                <div class="input-container">
                    <textarea id="message-input" name="query" placeholder="Ø§Ø³Ø£Ù„Ù†ÙŠ Ø¹Ù† Ø§Ù„Ø¹Ù„Ù…! ğŸ”¬" rows="1"></textarea>
                    <div class="input-buttons">
                        <button type="submit" class="action-btn" title="Ø¥Ø±Ø³Ø§Ù„">ğŸš€</button>
                        <button type="button" class="action-btn" title="Ø¥Ø¯Ø®Ø§Ù„ ØµÙˆØªÙŠ" disabled>ğŸ¤</button>
                        <button type="button" class="action-btn" title="Ø§Ù„Ø¨Ø­Ø«" disabled>ğŸ”</button>
                        <button type="button" class="action-btn" title="Ø¥Ø±ÙØ§Ù‚" disabled>ğŸ“</button>
                    </div>
                </div>
            </form>
            <div class="disclaimer">
                <p>ğŸŒŸ ØªØ°ÙƒØ±: Ø§Ø³Ø£Ù„ Ø´Ø®ØµÙ‹Ø§ Ø¨Ø§Ù„ØºÙ‹Ø§ Ù‚Ø¨Ù„ Ø¥Ø¬Ø±Ø§Ø¡ Ø£ÙŠ ØªØ¬Ø§Ø±Ø¨ Ø¹Ù„Ù…ÙŠØ©!</p>
            </div>
        </div>
    </div>
    <script>
        document.getElementById('message-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                document.getElementById('message-form').submit();
            }
        });

        document.getElementById('message-form').addEventListener('submit', function(e) {
            const messageInput = document.getElementById('message-input');
            if (!messageInput.value.trim()) {
                e.preventDefault();
                return;
            }
            const loading = document.getElementById('loading');
            loading.classList.remove('hidden');
            const chatMessages = document.getElementById('chat-messages');
            chatMessages.innerHTML += `
                <div class="message user-message">
                    <div class="message-content">${messageInput.value}</div>
                </div>
            `;
            chatMessages.scrollTop = chatMessages.scrollHeight;
        });
    </script>
</body>
</html>